# Repair Incident: E03 Backfill

**Date**: 2025-12-21  
**Type**: Data Repair  
**Status**: RESOLVED

---

## Summary

Genesis extraction was interrupted during persistence, resulting in 137 missing E03 (AcceptanceCriterion) entities and their corresponding R02 relationships.

## Detection

| Metric | Expected | Before Repair | After Repair |
|--------|----------|---------------|--------------|
| E03 (AcceptanceCriteria) | 2,849 | 2,712 | 2,849 ✓ |
| R02 (HAS_AC) | 2,849 | 2,712 | 2,849 ✓ |
| Total Entities | 3,830 | 3,693 | 3,830 ✓ |
| Total Relationships | 3,825 | 3,688 | 3,825 ✓ |

### Missing ACs Distribution
- Epic 64: 116 ACs (Stories 64.4-64.15)
- Epic 65: 21 ACs (Stories 65.1-65.3)

## Root Cause

The genesis extraction run (`scripts/si-readiness/genesis-extract.ts`) was interrupted multiple times during execution. The BRD entity extraction stopped partway through Epic 64 Story 64.4.

## Repair Actions

1. **Detection** (`scripts/repair/detect-missing-e03.ts`)
   - Compared BRD parser output to DB state
   - Identified exactly 137 missing E03 instance_ids
   - Output: `si-readiness-results/missing-e03.json`

2. **Backfill** (`scripts/repair/backfill-missing-brd-acs.ts`)
   - Inserted 137 E03 entities via `entity-service` (ledgered)
   - Inserted 137 R02 relationships via `relationship-service` (ledgered)
   - Script is idempotent (safe to re-run)
   - Output: `si-readiness-results/ledger-delta.json`

3. **Neo4j Sync** (`scripts/repair/sync-neo4j.ts`)
   - Synced entities and relationships via `replaceRelationshipsInNeo4j`
   - Verified parity: PostgreSQL = Neo4j = 3,825 relationships

## Verification

All gates passed after repair:

```
✓ PASS: Entity Counts (3830 entities)
✓ PASS: Relationship Counts (3825 relationships)
✓ PASS: Neo4j Parity (PG=3825, Neo4j=3825)
✓ PASS: No Null Instance IDs (E=0, R=0)
✓ PASS: No Duplicate Instance IDs (E=0, R=0)
✓ PASS: Ledger Coverage (100% coverage)
✓ PASS: Corpus Keying (99 valid refs)
```

## Artifacts

| Artifact | Path |
|----------|------|
| Missing E03 Report | `si-readiness-results/missing-e03.json` |
| Ledger Delta Report | `si-readiness-results/ledger-delta.json` |
| Corpus Delta Report | `si-readiness-results/corpus-delta.json` |
| Detection Script | `scripts/repair/detect-missing-e03.ts` |
| Backfill Script | `scripts/repair/backfill-missing-brd-acs.ts` |
| Neo4j Sync Script | `scripts/repair/sync-neo4j.ts` |

## Invariant Updates Required

Update `.cursorrules` locked invariants:

```
1. **Entity counts:** E01=65, E02=351, E03=2849, Total=3830
2. **Relationship counts:** Total=3825 (R01-R67)
3. **Cross-store parity:** PostgreSQL = Neo4j = 3825 relationships
6. **Shadow ledger coverage:** 100% (7656 mutations logged)
```

---

*Generated by Formal Systems Repair Mode*
